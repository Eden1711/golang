<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Go Chat Realtime</title>
    <style>
      body {
        font-family: sans-serif;
        padding: 20px;
      }
      #chat-box {
        width: 100%;
        height: 300px;
        border: 1px solid #ccc;
        overflow-y: scroll;
        margin-bottom: 10px;
        padding: 10px;
      }
      .msg {
        margin-bottom: 5px;
      }
      .broadcast {
        color: blue;
      }
      .private {
        color: red;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <h2>Go Chat Room</h2>

    <div id="login-screen">
      <input
        type="text"
        id="username"
        placeholder="Nh·∫≠p t√™n b·∫°n (vd: Batman)..."
      />
      <button onclick="connect()">Tham gia Chat</button>
    </div>

    <div id="chat-screen" style="display: none">
      <h3>Xin ch√†o, <span id="my-name"></span></h3>
      <div id="chat-box"></div>

      <input
        type="text"
        id="recipient"
        placeholder="T√™n ng∆∞·ªùi nh·∫≠n (ƒë·ªÉ tr·ªëng n·∫øu chat all)"
      />
      <input
        type="text"
        id="content"
        placeholder="N·ªôi dung tin nh·∫Øn..."
        style="width: 50%"
      />
      <button onclick="send()">G·ª≠i</button>
    </div>

    <script>
      let socket;
      let myName;

      function connect() {
        myName = document.getElementById("username").value;
        if (!myName) return alert("Vui l√≤ng nh·∫≠p t√™n!");

        // üëá K·∫æT N·ªêI WEBSOCKET T·∫†I ƒê√ÇY
        socket = new WebSocket("ws://localhost:8080/ws?name=" + myName);

        socket.onopen = () => {
          console.log("ƒê√£ k·∫øt n·ªëi!");
          document.getElementById("login-screen").style.display = "none";
          document.getElementById("chat-screen").style.display = "block";
          document.getElementById("my-name").innerText = myName;
        };

        socket.onmessage = (event) => {
          const msg = JSON.parse(event.data);
          const box = document.getElementById("chat-box");

          let html = "";
          if (msg.type === "private") {
            html = `<div class="msg private">[M·∫≠t] ${msg.sender}: ${msg.content}</div>`;
          } else {
            html = `<div class="msg broadcast">${msg.sender}: ${msg.content}</div>`;
          }

          box.innerHTML += html;
          box.scrollTop = box.scrollHeight; // T·ª± cu·ªôn xu·ªëng cu·ªëi
        };

        socket.onclose = () => alert("M·∫•t k·∫øt n·ªëi v·ªõi Server!");
        socket.onerror = (err) => console.error("L·ªói Socket:", err);
      }

      function send() {
        const recipient = document.getElementById("recipient").value;
        const content = document.getElementById("content").value;

        const msg = {
          type: recipient ? "private" : "broadcast",
          sender: myName,
          recipient: recipient,
          content: content,
        };

        socket.send(JSON.stringify(msg));
        document.getElementById("content").value = ""; // X√≥a √¥ nh·∫≠p

        // Hi·ªán tin nh·∫Øn m√¨nh v·ª´a g·ª≠i l√™n m√†n h√¨nh lu√¥n cho tr·ª±c quan
        const box = document.getElementById("chat-box");
        box.innerHTML += `<div class="msg" style="color: #666">T√¥i: ${content}</div>`;
      }
    </script>
  </body>
</html>
