version: "3.8"

services:
  # 1. Service Auth (Server gRPC)
  auth-service:
    build:
      context: .
      dockerfile: auth_service/Dockerfile
    container_name: go_auth_container
    ports:
      - "50051:50051" # Map port ra ngo√†i (ƒë·ªÉ debug n·∫øu c·∫ßn)
    networks:
      - go-network

  # 2. Service Gateway (Client HTTP)
  api-gateway:
    build:
      context: .
      dockerfile: gateway/Dockerfile
    container_name: go_gateway_container
    ports:
      - "8080:8080" # Map port web ra ngo√†i ƒë·ªÉ user truy c·∫≠p
    environment:
      # üî• QUAN TR·ªåNG: Ch·ªâ ƒë·ªãnh ƒë·ªãa ch·ªâ c·ªßa Auth Service
      # Trong m·∫°ng Docker, t√™n service "auth-service" ch√≠nh l√† domain/IP
      - AUTH_SERVICE_HOST=auth-service:50051
    depends_on:
      - auth-service # Ch·ªù Auth ch·∫°y tr∆∞·ªõc r·ªìi m·ªõi ch·∫°y Gateway
    networks:
      - go-network

  jaeger:
    image: jaegertracing/all-in-one:latest
    container_name: jaeger_container
    environment:
      - COLLECTOR_OTLP_ENABLED=true
    ports:
      - "16686:16686" # C·ªïng Web UI (ƒë·ªÉ b·∫°n v√†o xem bi·ªÉu ƒë·ªì)
      - "4317:4317" # C·ªïng nh·∫≠n d·ªØ li·ªáu t·ª´ code Go (gRPC)
    networks:
      - go-network

# T·∫°o m·∫°ng n·ªôi b·ªô ƒë·ªÉ 2 th·∫±ng n√≥i chuy·ªán v·ªõi nhau
networks:
  go-network:
    driver: bridge
